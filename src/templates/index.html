<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Voice Recorder</title>
    <style>
      /* Minimal CSS for styling */
      body { font-family: Arial, sans-serif; }
      .container {
        max-width: 600px;
        margin: 0 auto;
        padding: 20px;
        text-align: center;
      }
      .mic-button-container {
        display: flex;
        justify-content: center;
        margin-top: 20px;
      }
      .mic-button {
        background-color: #E34234;
        border: none;
        color: white;
        padding: 15px;
        border-radius: 8px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: box-shadow 0.3s ease;
      }
      .mic-button img {
        width: 24px;
        height: 24px;
        margin-right: 10px;
      }
      .mic-button.blinking {
        animation: blink 1s infinite;
      }
      @keyframes blink {
        0% { opacity: 1; }
        50% { opacity: 0.5; }
        100% { opacity: 1; }
      }
      .chat-box {
        border: 1px solid #ccc;
        padding: 10px;
        margin-top: 20px;
        height: 300px;
        overflow-y: scroll;
        text-align: left;
      }
      .chat-message {
        margin: 5px 0;
      }
    </style>
    <script>
      function startRecognition() {
        if (!('webkitSpeechRecognition' in window)) {
          alert('Your browser does not support speech recognition. Please use Google Chrome.');
          return;
        }

        const recognition = new webkitSpeechRecognition();
        recognition.continuous = false;
        recognition.interimResults = false;
        recognition.lang = 'en-US';

        recognition.onstart = function() {
          console.log('Speech recognition started');
          document.querySelector('.mic-button').classList.add('blinking');
        };

        recognition.onresult = function(event) {
          const transcript = event.results[0][0].transcript;
          console.log('You said:', transcript);
          displayMessage('You: ' + transcript);
          sendTextToServer(transcript);
        };

        recognition.onerror = function(event) {
          console.error('Speech recognition error', event);
        };

        recognition.onend = function() {
          console.log('Speech recognition ended');
          document.querySelector('.mic-button').classList.remove('blinking');
        };

        recognition.start();
      }

      function sendTextToServer(text) {
        fetch('/process', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ text: text })
        })
        .then(response => response.json())
        .then(data => {
          console.log(data.message);
          console.log('Server response:', data.text);
          displayMessage('Server: ' + data.text);
        });
      }

      function displayMessage(message) {
        const chatBox = document.getElementById('chat-box');
        const messageDiv = document.createElement('div');
        messageDiv.className = 'chat-message';
        messageDiv.textContent = message;
        chatBox.appendChild(messageDiv);
        chatBox.scrollTop = chatBox.scrollHeight;
      }
    </script>
  </head>
  <body>
    <div class="container">
      <h1>AI Voice Recorder</h1>
      <div id="chat-box" class="chat-box"></div>
      <div class="mic-button-container">
        <button class="mic-button" onclick="startRecognition()">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-mic"><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" x2="12" y1="19" y2="22"/></svg>
        </button>
      </div>
    </div>
  </body>
</html>